<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>显示地图</title>
    <link rel="stylesheet" href="main1119.css">
    <script src="amap.js"></script>
    <!--
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.2&key=a26271caa073b05146f4d1b2015a2d2f"></script>
     <script src="amap.js"></script>
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.2&key=a26271caa073b05146f4d1b2015a2d2f&plugin=AMap.LineSearch"></script>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
    -->
	<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
    <script src="addToolbar.js"></script>

    <!-- 	<script src="http://webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script> -->
	
</head>
    <style>
        .marker {
            color: #ff6600;
            padding: 4px 10px;
            border: 1px solid #fff;
            white-space: nowrap;
            font-size: 12px;
            font-family: "";
            background-color: #0066ff;
        }
        .amap-logo {
            visibility: hidden;
     	} 
   		.amap-copyright {
          bottom:-100px;
           display: none;
    	}  
    </style>
<body>
<div id="container"></div>
<!--
<div  class="button-group">
	
    <input type="button" class="button" value="添加公交车线路" id="addBusLine"/>
	<input type="button" class="button" value="删除公交车线路"  onclick="destroyBusLine()"/>
    <input type="button" class="button" value="添加点标记覆盖物" id="addMarker"/>
    <input type="button" class="button" value="删除点标记覆盖物" id="clearMarker"/>	
	<input type="button" class="button" value="保存线路与站点信息"  onclick="ache()"/>
	
</div>
-->
<!--<div id="tip" onclick="ache();">请拖拽路径试试</div>-->
<script type="text/javascript">


	
	//var infoWindow = new AMap.InfoWindow({offset: new AMap.Pixel(0, -30)});//点击点标弹出站名
	var siteNumbe=[];//放点的位置信息
	var markers=[];//存放所有的标记点信息
	var operateStatu=0;
    var map, route, marker;
    //基本地图加载
    map = new AMap.Map("container", {
        //resizeEnable: true,
		zoom:19,//级别
		center: [103.9999616146,30.55667158459],//设置地图中心
		viewMode:'3D'//使用3D视图
    });
    var patha = [];
	var pathb = [];

	
	
	
	
	
	/*
    //为地图注册click事件获取鼠标点击出的经纬度坐标
	
    var clickEventListener = map.on('click', function(e) {
	 
	if(operateStatu==1){
	var ln = e.lnglat.getLng();
	var la = e.lnglat.getLat();
	patha.push(ln);
	pathb.push(la);
    var path=[]	
	var lengths = patha.length;
	   if(lengths>1){	   
		
		path.push([patha[0],pathb[0]]);
		if(route){
		var dian = route.getWays();
		 console.info(dian);
		  if(dian){
		  $.each(dian,function(i,field){		 
		  path.push([dian[i].lng,dian[i].lat]);
		  });
		  }
		
		
		}
		path.push([ln,la]);
		//$.each(patha,function(i,field){
		//path.push([patha[i],pathb[i]]);		
		//});
		
		ache(path)
		}else{
		
		var singpath=[];
		singpath.push([ln,la]);
		singpath.push([ln,la-0.00001]);
		ache(singpath);
		}
	
	};
   
		
	
        
          
    });
	
	function ache(path){
	//每次画新线路将之前的线路清除
if(route){route.destroy();}	
	map.plugin("AMap.DragRoute", function() {
        route = new AMap.DragRoute(map, path, AMap.DrivingPolicy.LEAST_FEE); //构造拖拽导航类
		
        route.search(); //查询导航路径并开启拖拽导航 
		route.on('complete', function(type,target,data) {
		//console.info(type);
       //alert(type+":"+data+";;"+target);
    });        
    });	
	}
	
	//添加公交车线路
    AMap.event.addDomListener(document.getElementById('addBusLine'), 'click', function() {
	operateStatu=1;
    }, false);
	//删除公交线路
	function destroyBusLine(){
	if(operateStatu==1){
	patha=[];
	pathb=[];
	//path=[];
	route.destroy();
	route="";
	}	
	}
	//添加点标记覆盖物
	AMap.event.addDomListener(document.getElementById('addMarker'), 'click', function(e) {
	operateStatu=2;
	console.info("abc");         
    }, false);
	var clickEventListener = map.on('click', function(ed) {
		if(operateStatu==2){
		
		addMarker([ed.lnglat.getLng(), ed.lnglat.getLat()]);
		};
	
	});
	//删除点标记覆盖物
    AMap.event.addDomListener(document.getElementById('clearMarker'), 'click', function() {
	if(operateStatu==2){
		if(siteNumbe.length>0){
			$.each(siteNumbe,function(i,field){
			markers[field].setMap(null);//删除站名相同的
					marker = null;
			})
			}  
	};
		 
    }, false);
	

	    // 实例化点标记
 function addMarker(abc) { 
 var person=prompt("请输入该站点名称(设置后不可修改)","北京站");
	if (person!=null && person!=""){	
	 marker = new AMap.Marker({
           icon: "aa.png",
           draggable: true,  //是否可拖动
           position: abc
        });
        marker.setMap(map);
		marker.content = person;//站名
        marker.on('click', markerClick);
        marker.emit('click', {target: marker});
	markers.push(marker);
	}       
    }
//点击点标弹出站名	
function markerClick(e) {
	 var site=e.target.content;
	 
	$.each(markers,function(i,field){
	  if(site==field.content){
	  siteNumbe.push(i);//判断站名是否相同，将相同的记录
	  }
	})
	
        infoWindow.setContent(e.target.content);
        infoWindow.open(map, e.target.getPosition());
    }	
	*/
    //绘制公交线路线段：
    // 创建一条折线覆盖物
var path = [
    new AMap.LngLat(103.9963020000,30.5539600000),
    new AMap.LngLat(103.9961250000,30.5542520000),
    new AMap.LngLat(103.9958870000,30.5546600000),
    new AMap.LngLat(103.9950470000,30.5557010000),
    new AMap.LngLat(103.9948030000,30.5560220000),
    new AMap.LngLat(103.9946800000,30.5564330000),
    new AMap.LngLat(103.9946900000,30.5569180000),
    new AMap.LngLat(103.9947330000,30.5572690000),
    new AMap.LngLat(103.9951780000,30.5584380000),
	new AMap.LngLat(103.9954390000,30.5588650000),
    new AMap.LngLat(103.9956780000,30.5590940000),
    new AMap.LngLat(103.9958880000,30.5592320000),
    new AMap.LngLat(103.9961070000,30.5593950000),
    new AMap.LngLat(103.9965680000,30.5595890000),
    new AMap.LngLat(103.9969170000,30.5596990000),
    new AMap.LngLat(103.9974880000,30.5597620000),
	new AMap.LngLat(103.9982670000,30.5597770000),
    new AMap.LngLat(103.9985610000,30.5598080000),
    new AMap.LngLat(103.9990920000,30.5598950000),
    new AMap.LngLat(104.0001650000,30.5602040000),
    new AMap.LngLat(104.0011270000,30.5603960000),
    new AMap.LngLat(104.0014390000,30.5603170000),
    new AMap.LngLat(104.0017120000,30.5602060000),
    new AMap.LngLat(104.0020720000,30.5599520000),
    new AMap.LngLat(104.0023020000,30.5597300000),
    new AMap.LngLat(104.0028600000,30.5589270000),
    new AMap.LngLat(104.0030220000,30.5587850000),
    new AMap.LngLat(104.0033470000,30.5585790000),
    new AMap.LngLat(104.0046160000,30.5579890000),
    new AMap.LngLat(104.0050660000,30.5576800000),
    new AMap.LngLat(104.0056800000,30.5569810000),
    new AMap.LngLat(104.0069890000,30.5554750000)
	];
	
var polyline1 = new AMap.Polyline({
    path: path,  
	strokeStyle: 'dashed',
    borderWeight: 2, // 线条宽度,默认为 1
    strokeColor: 'red', // 线条颜色
    lineJoin: 'round' // 折线拐点连接处样式
});
map.add(polyline1);
	//提前设置偏移量
	pixel_1 = new AMap.Pixel(-5,-5);
//显示公交站点：
		marker1 = new AMap.Marker({
            icon: "amap_bus.png",
			offset: pixel_1,
            position: [103.9963020000,30.5539600000]
        });
        marker1.setMap(map);
		marker2 = new AMap.Marker({
            icon: "amap_bus.png",
			offset: pixel_1,
            position: [103.9950470000,30.5557010000]
        });
        marker2.setMap(map);
		marker3 = new AMap.Marker({
            icon: "amap_bus.png",
			offset: pixel_1,
            position: [103.9958041906,30.5593000067]
        });
        marker3.setMap(map);
		marker4 = new AMap.Marker({
            icon: "amap_bus.png",
			offset: pixel_1,
            position: [103.9985610000,30.5598340000]
        });
        marker4.setMap(map);
		marker5 = new AMap.Marker({
            icon: "amap_bus.png",
			offset: pixel_1,
            position: [104.0033470000,30.5585790000]
        });
        marker5.setMap(map);
		marker6 = new AMap.Marker({
            icon: "amap_bus.png",
			offset: pixel_1,
            position: [104.0056800000,30.5569810000]
        });
        marker6.setMap(map);
		marker6 = new AMap.Marker({
            icon: "amap_bus.png",
			offset: pixel_1,
            position: [104.0069890000,30.5554750000]
        });
        marker6.setMap(map);
		/*
		item1.setLatLonPoint(new LatLonPoint(30.5539600000,103.9963020000));
        item2.setLatLonPoint(new LatLonPoint(30.5557010000,103.9950470000));
        item3.setLatLonPoint(new LatLonPoint(30.5592320000,103.9958880000));
        item4.setLatLonPoint(new LatLonPoint(30.5598080000,103.9985610000));
        item5.setLatLonPoint(new LatLonPoint(30.5585790000,104.0033470000));
        item6.setLatLonPoint(new LatLonPoint(30.5569810000,104.0056800000));
        item7.setLatLonPoint(new LatLonPoint(30.5554750000,104.0069890000));
		*/
		//添加公交车
		bus_marker=new AMap.Marker({
			icon:"bus.png",
			offset: pixel_1,
			position:[103.9963020000,30.5539600000]
		});
		bus_marker.moveAlong(path,40,function(k){return k},true);
		//bus_marker.moveAlong(path,40);
		bus_marker.setMap(map);
		
		
		/*
		<!-- //加载PathSimplifier，loadUI的路径参数为模块名中 'ui/' 之后的部分 
		AMapUI.load(['ui/misc/PathSimplifier'], function(PathSimplifier) {

			if (!PathSimplifier.supportCanvas) {
				alert('当前环境不支持 Canvas！');
				return;
			}

			//启动页面
			initPage(PathSimplifier);
		});
		
	function initPage(PathSimplifier) {
    //创建组件实例
    var pathSimplifierIns = new PathSimplifier({
        zIndex: 100,
        map: map, //所属的地图实例
        getPath: function(pathData, pathIndex) {
            //返回轨迹数据中的节点坐标信息，[AMap.LngLat, AMap.LngLat...] 或者 [[lng|number,lat|number],...]
            return pathData.path;
        },
        getHoverTitle: function(pathData, pathIndex, pointIndex) {
            //返回鼠标悬停时显示的信息
            if (pointIndex >= 0) {
                //鼠标悬停在某个轨迹节点上
                return pathData.name + '，点:' + pointIndex + '/' + pathData.path.length;
            }
            //鼠标悬停在节点之间的连线上
            return pathData.name + '，点数量' + pathData.path.length;
        },
        renderOptions: {
            //轨迹线的样式
            pathLineStyle: {
                strokeStyle: 'red',
                lineWidth: 6,
                dirArrowStyle: true
            }
        }
    });

    //这里构建两条简单的轨迹，仅作示例
    pathSimplifierIns.setData([{
        name: '轨迹0',
        path: path,
    }]);

    //创建一个巡航器
    var navg0 = pathSimplifierIns.createPathNavigator(0, //关联第1条轨迹
        {
            loop: true, //循环播放
            speed: 40
        });

    navg0.start();
} */
</script>
</body>
</html>